{{- define "common.probes.tpl" -}}
{{/* magic one-liner to get values merged from common and chart */}}
{{- $values := index (merge (omit . "Values") (dict "Values" (omit .Values "common")) (dict "Values" .Values.common)) "Values" -}}
livenessProbe:
  httpGet:
    path: {{ tpl (default $values.probePath $values.livenessProbePath) . }}
    port: {{ $values.service.internalPort }}
  initialDelaySeconds: {{ $values.livenessProbe.initialDelaySeconds }}
  periodSeconds: {{ $values.livenessProbe.periodSeconds }}
  successThreshold: {{ $values.livenessProbe.successThreshold }}
  timeoutSeconds: {{ $values.livenessProbe.timeoutSeconds }}
  failureThreshold: {{ $values.livenessProbe.failureThreshold }}
readinessProbe:
    httpGet:
      path: {{ tpl (default $values.probePath $values.readinessProbePath) . }}
      port: {{ $values.service.internalPort }}
    initialDelaySeconds: {{ $values.readinessProbe.initialDelaySeconds }}
    periodSeconds: {{ $values.readinessProbe.periodSeconds }}
    successThreshold: {{ $values.readinessProbe.successThreshold }}
    timeoutSeconds: {{ $values.readinessProbe.timeoutSeconds }}
    failureThreshold: {{ $values.readinessProbe.failureThreshold }}
{{- end -}}
